{"ast":null,"code":"import _asyncToGenerator from \"/Users/advityasood/jude_anyft/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport Web3 from 'web3';\nimport Web3Modal from 'web3modal';\nimport WalletConnectProvider from '@walletconnect/web3-provider';\nimport { Subject } from 'rxjs';\nimport Authereum from 'authereum';\nimport Fortmatic from 'fortmatic'; // import DcentProvider from 'dcent-provider'\n\nimport { nftMarketContract, nftMarketabi } from '../../nftmarket';\nimport { NFTContract, NFTabi } from '../../NFT';\nimport { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class ContractService {\n  constructor(_HTTP) {\n    this._HTTP = _HTTP;\n    this.BASE_API_URL = environment.BASE_API_URL + '/auths';\n    this.accountStatusSource = new Subject();\n    this.accountStatus$ = this.accountStatusSource.asObservable();\n    const providerOptions = {\n      walletconnect: {\n        // display: {\n        //     name: \"Mobile\"\n        //   },\n        package: WalletConnectProvider,\n        options: {\n          infuraId: 'INFURA_ID' // required\n\n        }\n      },\n      fortmatic: {\n        package: Fortmatic,\n        options: {\n          key: 'FORMATIC_KEY'\n        }\n      },\n      authereum: {\n        package: Authereum // required\n\n      } // portis: {\n      //   package: Portis, // required\n      //   options: {\n      //     id: \"PORTIS_ID\" // required\n      //   }\n      // },\n      // torus: {\n      //   package: Torus, // required\n      // }\n\n    };\n    this.web3Modal = new Web3Modal({\n      network: 'mainnet',\n      cacheProvider: true,\n      providerOptions,\n      theme: {\n        background: 'rgb(0, 0, 0)',\n        main: 'rgb(199, 199, 199)',\n        secondary: 'rgb(136, 136, 136)',\n        border: 'rgba(195, 195, 195, 0.14)',\n        hover: 'rgb(7, 7, 22)'\n      }\n    });\n  }\n\n  connectAccount() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.web3Modal.clearCachedProvider();\n\n      _this.provider = yield _this.web3Modal.connect(); // set provider\n\n      _this.web3js = new Web3(_this.provider); // create web3 instance\n\n      _this.accounts = yield _this.web3js.eth.getAccounts();\n      console.log(_this.accounts, 'accounts');\n\n      _this.accountStatusSource.next(_this.accounts); //Check User if it exists\n\n\n      let checkUser = yield _this._HTTP.post(_this.BASE_API_URL + '/start-up', {\n        accountId: _this.accounts[0]\n      }).toPromise();\n      let user = {\n        accountId: _this.accounts[0],\n        status: checkUser.status\n      };\n      localStorage.setItem('AccountId', _this.accounts[0]);\n      console.log(user, 'return object');\n      return user;\n    })();\n  }\n\n  getAccount() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      _this2.provider = yield _this2.web3Modal.connect(); // set provider\n\n      _this2.web3js = new Web3(_this2.provider);\n      _this2.accounts = _this2.web3js.eth.getAccounts();\n      console.log('aa', _this2.accounts);\n      return _this2.accounts;\n    })();\n  } //List Token on The MarketPlace -2\n\n\n  createMarketItem(nftContract, tokenId, price) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      _this3.provider = yield _this3.web3Modal.connect(); // set provider\n\n      _this3.web3js = new Web3(_this3.provider); // create web3 instance\n\n      _this3.accounts = yield _this3.web3js.eth.getAccounts();\n      _this3.nftmarket = new _this3.web3js.eth.Contract(nftMarketabi, nftMarketContract); // price = this.web3js.utils.toWei('0.025', 'ether'); \n\n      price = _this3.web3js.utils.toWei(price, 'ether');\n      const createMarketItem = yield _this3.nftmarket.methods.createMarketItem(nftContract, tokenId, price).send({\n        from: _this3.accounts[0],\n        value: price\n      });\n      return createMarketItem;\n    })();\n  }\n\n  createMarketSale(nftContract, itemId) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      _this4.provider = yield _this4.web3Modal.connect(); // set provider\n\n      _this4.web3js = new Web3(_this4.provider); // create web3 instance\n\n      _this4.accounts = yield _this4.web3js.eth.getAccounts();\n      _this4.nftmarket = new _this4.web3js.eth.contract(nftMarketContract, nftMarketabi);\n      const createMarketSale = yield _this4.nftmarket.methods.createMarketSale().send({\n        from: _this4.accounts[0]\n      });\n      return createMarketSale;\n    })();\n  } //Fetch my NFTs on the marketplace\n\n\n  fetchMyNFTs() {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      _this5.provider = yield _this5.web3Modal.connect(); // set provider\n\n      _this5.web3js = new Web3(_this5.provider); // create web3 instance\n\n      _this5.accounts = yield _this5.web3js.eth.getAccounts();\n      _this5.nftmarket = new _this5.web3js.eth.Contract(nftMarketabi, nftMarketContract); // let try1 = await this.nftmarket.methods.userOwnedTokens(this.accounts[0])\n      // this.NFT = new this.web3js.eth.Contract(NFTabi,NFTContract)\n      // let try2 = await this.nftmarket.methods.fetchMyNFTs().call();\n      // console.log('this shit',try2)\n\n      const fetchMyNFTs = yield _this5.nftmarket.methods.fetchMyNFTs().call();\n      return fetchMyNFTs;\n    })();\n  }\n\n  fetchMarketItems() {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      _this6.provider = yield _this6.web3Modal.connect(); // set provider\n\n      _this6.web3js = new Web3(_this6.provider); // create web3 instance\n\n      _this6.accounts = yield _this6.web3js.eth.getAccounts();\n      _this6.nftmarket = new _this6.web3js.eth.Contract(nftMarketabi, nftMarketContract);\n      const fetchMarketItems = yield _this6.nftmarket.methods.fetchMarketItems().call({\n        from: _this6.accounts[0]\n      });\n      return fetchMarketItems;\n    })();\n  } //Create Token -1\n\n\n  createToken(tokenURI) {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      console.log('create token', tokenURI);\n      _this7.provider = yield _this7.web3Modal.connect(); // set provider\n\n      _this7.web3js = new Web3(_this7.provider); // create web3 instance\n\n      _this7.accounts = yield _this7.web3js.eth.getAccounts();\n      _this7.NFT = new _this7.web3js.eth.Contract(NFTabi, NFTContract);\n      const mintNFT = yield _this7.NFT.methods.createToken(tokenURI).send({\n        from: _this7.accounts[0]\n      });\n      console.log('mingnt', mintNFT);\n      const receipt = yield _this7.web3js.eth.getTransactionReceipt(mintNFT.transactionHash);\n      console.log('rec', receipt);\n      const tokenId = Web3.utils.hexToNumber(receipt.logs[0].topics[3]);\n      console.log(tokenId);\n      return tokenId;\n    })();\n  }\n\n  getTokenURI(tokenId) {\n    var _this8 = this;\n\n    return _asyncToGenerator(function* () {\n      _this8.provider = yield _this8.web3Modal.connect();\n      _this8.web3js = new Web3(_this8.provider);\n      _this8.accounts = yield _this8.web3js.eth.getAccounts();\n      _this8.NFT = new _this8.web3js.eth.Contract(NFTabi, NFTContract);\n      const tokenURI = yield _this8.NFT.methods.tokenURI(tokenId).call({\n        from: _this8.accounts[0]\n      });\n      const tokenData = yield fetch(tokenURI);\n      return tokenData;\n    })();\n  }\n\n  test() {\n    var _this9 = this;\n\n    return _asyncToGenerator(function* () {\n      _this9.web3js = new Web3(_this9.provider);\n      const receipt = yield _this9.web3js.eth.getTransactionReceipt('0x33b6e3697c76adf5f136f5fe9f4d0df4751213f6d2beb5b71e266e7d829d2b64');\n      console.log(receipt, 'recc');\n    })();\n  }\n\n  balanceOf(ownerAddress) {\n    var _this10 = this;\n\n    return _asyncToGenerator(function* () {\n      _this10.provider = yield _this10.web3Modal.connect();\n      _this10.web3js = new Web3(_this10.provider);\n      _this10.accounts = yield _this10.web3js.eth.getAccounts();\n      _this10.NFT = new _this10.web3js.eth.Contract(NFTabi, NFTContract); // console.log('oA',ownerAddress)\n\n      const balance = yield _this10.NFT.methods.balanceOf(_this10.accounts[0]).call({\n        from: _this10.accounts[0]\n      });\n      return balance;\n    })();\n  }\n\n  approve(toAddress, tokenId) {\n    var _this11 = this;\n\n    return _asyncToGenerator(function* () {\n      console.log('inside approve');\n      _this11.provider = yield _this11.web3Modal.connect();\n      _this11.web3js = new Web3(_this11.provider);\n      _this11.accounts = yield _this11.web3js.eth.getAccounts();\n      _this11.NFT = new _this11.web3js.eth.Contract(NFTabi, NFTContract);\n      const approveFunction = yield _this11.NFT.methods.approve(toAddress, tokenId).send({\n        from: _this11.accounts[0]\n      });\n      return approveFunction;\n    })();\n  }\n\n}\n\nContractService.ɵfac = function ContractService_Factory(t) {\n  return new (t || ContractService)(i0.ɵɵinject(i1.HttpClient));\n};\n\nContractService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: ContractService,\n  factory: ContractService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["/Users/advityasood/jude_anyft/src/app/services/contract.service.ts"],"names":["Web3","Web3Modal","WalletConnectProvider","Subject","Authereum","Fortmatic","nftMarketContract","nftMarketabi","NFTContract","NFTabi","environment","i0","i1","ContractService","constructor","_HTTP","BASE_API_URL","accountStatusSource","accountStatus$","asObservable","providerOptions","walletconnect","package","options","infuraId","fortmatic","key","authereum","web3Modal","network","cacheProvider","theme","background","main","secondary","border","hover","connectAccount","clearCachedProvider","provider","connect","web3js","accounts","eth","getAccounts","console","log","next","checkUser","post","accountId","toPromise","user","status","localStorage","setItem","getAccount","createMarketItem","nftContract","tokenId","price","nftmarket","Contract","utils","toWei","methods","send","from","value","createMarketSale","itemId","contract","fetchMyNFTs","call","fetchMarketItems","createToken","tokenURI","NFT","mintNFT","receipt","getTransactionReceipt","transactionHash","hexToNumber","logs","topics","getTokenURI","tokenData","fetch","test","balanceOf","ownerAddress","balance","approve","toAddress","approveFunction","ɵfac","ContractService_Factory","t","ɵɵinject","HttpClient","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":"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","sourcesContent":["import Web3 from 'web3';\nimport Web3Modal from 'web3modal';\nimport WalletConnectProvider from '@walletconnect/web3-provider';\nimport { Subject } from 'rxjs';\nimport Authereum from 'authereum';\nimport Fortmatic from 'fortmatic';\n// import DcentProvider from 'dcent-provider'\nimport { nftMarketContract, nftMarketabi } from '../../nftmarket';\nimport { NFTContract, NFTabi } from '../../NFT';\nimport { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class ContractService {\n    constructor(_HTTP) {\n        this._HTTP = _HTTP;\n        this.BASE_API_URL = environment.BASE_API_URL + '/auths';\n        this.accountStatusSource = new Subject();\n        this.accountStatus$ = this.accountStatusSource.asObservable();\n        const providerOptions = {\n            walletconnect: {\n                // display: {\n                //     name: \"Mobile\"\n                //   },\n                package: WalletConnectProvider,\n                options: {\n                    infuraId: 'INFURA_ID', // required\n                },\n            },\n            fortmatic: {\n                package: Fortmatic,\n                options: {\n                    key: 'FORMATIC_KEY'\n                }\n            },\n            authereum: {\n                package: Authereum // required\n            },\n            // portis: {\n            //   package: Portis, // required\n            //   options: {\n            //     id: \"PORTIS_ID\" // required\n            //   }\n            // },\n            // torus: {\n            //   package: Torus, // required\n            // }\n        };\n        this.web3Modal = new Web3Modal({\n            network: 'mainnet',\n            cacheProvider: true,\n            providerOptions,\n            theme: {\n                background: 'rgb(0, 0, 0)',\n                main: 'rgb(199, 199, 199)',\n                secondary: 'rgb(136, 136, 136)',\n                border: 'rgba(195, 195, 195, 0.14)',\n                hover: 'rgb(7, 7, 22)',\n            },\n        });\n    }\n    async connectAccount() {\n        this.web3Modal.clearCachedProvider();\n        this.provider = await this.web3Modal.connect(); // set provider\n        this.web3js = new Web3(this.provider); // create web3 instance\n        this.accounts = await this.web3js.eth.getAccounts();\n        console.log(this.accounts, 'accounts');\n        this.accountStatusSource.next(this.accounts);\n        //Check User if it exists\n        let checkUser = await this._HTTP.post(this.BASE_API_URL + '/start-up', { accountId: this.accounts[0] }).toPromise();\n        let user = {\n            accountId: this.accounts[0],\n            status: checkUser.status\n        };\n        localStorage.setItem('AccountId', this.accounts[0]);\n        console.log(user, 'return object');\n        return user;\n    }\n    async getAccount() {\n        this.provider = await this.web3Modal.connect(); // set provider\n        this.web3js = new Web3(this.provider);\n        this.accounts = this.web3js.eth.getAccounts();\n        console.log('aa', this.accounts);\n        return this.accounts;\n    }\n    //List Token on The MarketPlace -2\n    async createMarketItem(nftContract, tokenId, price) {\n        this.provider = await this.web3Modal.connect(); // set provider\n        this.web3js = new Web3(this.provider); // create web3 instance\n        this.accounts = await this.web3js.eth.getAccounts();\n        this.nftmarket = new this.web3js.eth.Contract(nftMarketabi, nftMarketContract);\n        // price = this.web3js.utils.toWei('0.025', 'ether'); \n        price = this.web3js.utils.toWei(price, 'ether');\n        const createMarketItem = await this.nftmarket.methods\n            .createMarketItem(nftContract, tokenId, price)\n            .send({ from: this.accounts[0], value: price });\n        return createMarketItem;\n    }\n    async createMarketSale(nftContract, itemId) {\n        this.provider = await this.web3Modal.connect(); // set provider\n        this.web3js = new Web3(this.provider); // create web3 instance\n        this.accounts = await this.web3js.eth.getAccounts();\n        this.nftmarket = new this.web3js.eth.contract(nftMarketContract, nftMarketabi);\n        const createMarketSale = await this.nftmarket.methods\n            .createMarketSale()\n            .send({ from: this.accounts[0] });\n        return createMarketSale;\n    }\n    //Fetch my NFTs on the marketplace\n    async fetchMyNFTs() {\n        this.provider = await this.web3Modal.connect(); // set provider\n        this.web3js = new Web3(this.provider); // create web3 instance\n        this.accounts = await this.web3js.eth.getAccounts();\n        this.nftmarket = new this.web3js.eth.Contract(nftMarketabi, nftMarketContract);\n        // let try1 = await this.nftmarket.methods.userOwnedTokens(this.accounts[0])\n        // this.NFT = new this.web3js.eth.Contract(NFTabi,NFTContract)\n        // let try2 = await this.nftmarket.methods.fetchMyNFTs().call();\n        // console.log('this shit',try2)\n        const fetchMyNFTs = await this.nftmarket.methods\n            .fetchMyNFTs()\n            .call();\n        return fetchMyNFTs;\n    }\n    async fetchMarketItems() {\n        this.provider = await this.web3Modal.connect(); // set provider\n        this.web3js = new Web3(this.provider); // create web3 instance\n        this.accounts = await this.web3js.eth.getAccounts();\n        this.nftmarket = new this.web3js.eth.Contract(nftMarketabi, nftMarketContract);\n        const fetchMarketItems = await this.nftmarket.methods\n            .fetchMarketItems()\n            .call({ from: this.accounts[0] });\n        return fetchMarketItems;\n    }\n    //Create Token -1\n    async createToken(tokenURI) {\n        console.log('create token', tokenURI);\n        this.provider = await this.web3Modal.connect(); // set provider\n        this.web3js = new Web3(this.provider); // create web3 instance\n        this.accounts = await this.web3js.eth.getAccounts();\n        this.NFT = new this.web3js.eth.Contract(NFTabi, NFTContract);\n        const mintNFT = await this.NFT.methods\n            .createToken(tokenURI)\n            .send({ from: this.accounts[0] });\n        console.log('mingnt', mintNFT);\n        const receipt = await this.web3js.eth.getTransactionReceipt(mintNFT.transactionHash);\n        console.log('rec', receipt);\n        const tokenId = Web3.utils.hexToNumber(receipt.logs[0].topics[3]);\n        console.log(tokenId);\n        return tokenId;\n    }\n    async getTokenURI(tokenId) {\n        this.provider = await this.web3Modal.connect();\n        this.web3js = new Web3(this.provider);\n        this.accounts = await this.web3js.eth.getAccounts();\n        this.NFT = new this.web3js.eth.Contract(NFTabi, NFTContract);\n        const tokenURI = await this.NFT.methods\n            .tokenURI(tokenId)\n            .call({ from: this.accounts[0] });\n        const tokenData = await fetch(tokenURI);\n        return tokenData;\n    }\n    async test() {\n        this.web3js = new Web3(this.provider);\n        const receipt = await this.web3js.eth.getTransactionReceipt('0x33b6e3697c76adf5f136f5fe9f4d0df4751213f6d2beb5b71e266e7d829d2b64');\n        console.log(receipt, 'recc');\n    }\n    async balanceOf(ownerAddress) {\n        this.provider = await this.web3Modal.connect();\n        this.web3js = new Web3(this.provider);\n        this.accounts = await this.web3js.eth.getAccounts();\n        this.NFT = new this.web3js.eth.Contract(NFTabi, NFTContract);\n        // console.log('oA',ownerAddress)\n        const balance = await this.NFT.methods\n            .balanceOf(this.accounts[0])\n            .call({ from: this.accounts[0] });\n        return balance;\n    }\n    async approve(toAddress, tokenId) {\n        console.log('inside approve');\n        this.provider = await this.web3Modal.connect();\n        this.web3js = new Web3(this.provider);\n        this.accounts = await this.web3js.eth.getAccounts();\n        this.NFT = new this.web3js.eth.Contract(NFTabi, NFTContract);\n        const approveFunction = await this.NFT.methods\n            .approve(toAddress, tokenId)\n            .send({ from: this.accounts[0] });\n        return approveFunction;\n    }\n}\nContractService.ɵfac = function ContractService_Factory(t) { return new (t || ContractService)(i0.ɵɵinject(i1.HttpClient)); };\nContractService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: ContractService, factory: ContractService.ɵfac, providedIn: 'root' });\n"]},"metadata":{},"sourceType":"module"}